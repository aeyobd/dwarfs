### A Pluto.jl notebook ###
# v0.19.36

using Markdown
using InteractiveUtils

# ╔═╡ bb92b6c2-bf8d-11ee-13fb-770bf04d91e9
begin 
	using Pkg; Pkg.activate()

	import LilGuys as lguys
	using Plots
end

# ╔═╡ 6964cbd2-9ef9-4682-9ac1-80c10518c374
out = lguys.Output("out")

# ╔═╡ 76c5df92-1dde-4715-bd4f-2972e553e40f
begin
	asya_rho_dmi_x = [-0.9187524442706296, -0.7994860048047376, -0.688991005084083, -0.5664841611263199, -0.45872674451086654, -0.3383848259679312, -0.24515336052293424, -0.12267445108665288, -0.013646013743784569, 0.09876250069836304, 0.19237108218336219, 0.2974328174758366, 0.408276998715012, 0.5023185652829767, 0.5939856975250014, 0.693572266607073, 0.7862590088831778, 0.870286049499972, 0.9603190122353203, 1.0507570255321526, 1.1325074026481927, 1.2146209285434941, 1.2969858651321302]
	asya_rho_dmi_y = [8.38707562171112, 8.30733922394715, 8.18196423009459, 8.082097014803036, 7.938001016376781, 7.808593301749152, 7.671972590613269, 7.529024114358781, 7.368403796659071, 7.209521155390895, 7.0693267323486495, 6.861461287519877, 6.707529384764184, 6.511139161653087, 6.33124047146768, 6.121866854641727, 5.932165046474648, 5.72577498729529, 5.509483451090966, 5.296437763315355, 5.0865395649251655, 4.85792036196128, 4.637104309765414]
	
	asya_rho_dmf_x = [-0.8257165204760042, -0.7195374043242639, -0.6070031845354489, -0.50118721716297, -0.39855578523939883, -0.30419297167439524, -0.18668640706184703, -0.07730878820045813, 0.019679870383820325, 0.12267445108665288, 0.22400692776132744, 0.3256746186937818, 0.41333314710319013, 0.48903570031845356, 0.5707022738700486, 0.6463629253030896, 0.7210039667020504, 0.8051148108832895, 0.8892256550645288, 0.9836583049332365]
	asya_rho_dmf_y = [8.11744069769348, 7.969082474057802, 7.9067884133046995, 7.796691857510533, 7.686431369977541, 7.50725397944296, 7.370436550220488, 7.200275405321224, 7.026704480254422, 6.838740348518877, 6.626579892132916, 6.396157440041966, 6.141440304257307, 5.893214865330076, 5.578629858526909, 5.194177144636973, 4.817593154210587, 4.356125309421157, 3.9660661300634414, 3.587449386075638]

	asya_fornax1_vmax_x = [-10.230335175684273, -9.972075577696813, -9.694814153881742, -9.289827413851505, -8.954321263043102, -8.566105699721582, -7.98035376442693, -7.4644955015242775, -6.863459488933502, -6.441205872390347, -5.848101056666749, -5.445097115853306, -4.944688163514843, -4.404210143670327, -3.8797597508282324, -3.37538520005618, -2.8509348072140854, -2.2484116952107147, -1.8492081195627925, -1.256681620277428, -0.7329747771416297, -0.2630513627613791, 0.3408762320205536, 0.7667649804611649]
	asya_fornax1_vmax_y = [39.788822260618176, 39.502433625820146, 38.97437634809319, 38.16512518209845, 37.590089327054464, 36.61279940373344, 36.04724960757078, 35.95216316021276, 35.80558096464185, 35.680455330826305, 35.481473952863325, 34.67945026030198, 34.08815259003286, 34.24467256157469, 34.082280267868235, 34.04139987126063, 33.897753836772026, 33.37466544703052, 32.859933823446376, 32.936951587220925, 32.75197343903513, 32.79962959198654, 32.67902112906687, 32.35265553184041]
end

# ╔═╡ ad48a5bb-73e5-471f-ba06-4d1ad2016c5a


# ╔═╡ dc6bef2c-e4eb-41ab-8f37-3569c068573a
begin
	cens = lguys.ss_centre(out)
	
	snap_i = out[1]
	snap_f = out[end]

	prof_i = lguys.Profile(snap_i, cens[1].x_c, cens[1].v_c)
	prof_f = lguys.Profile(snap_f, cens[end].x_c, cens[end].v_c)
end

# ╔═╡ 531cf5af-1e2d-4aaa-8c40-53358c47c398
profs = [lguys.Profile(out[i], cens[i].x_c, cens[i].v_c) for i in 1:length(out)]

# ╔═╡ 58957148-946c-4bbd-8d10-ebcbc899122f
V_maxs = [maximum(prof.Vs_circ) for prof in profs]

# ╔═╡ dfefa40c-f270-43bc-8421-8536a3da78f0

begin 
	plot(out.times * lguys.T0/1e9, V_maxs * lguys.V0)
	plot!(asya_fornax1_vmax_x .+ 10, asya_fornax1_vmax_y )
	xlabel!("time / Gyr")
	ylabel!("V_circ max / km / s")
end

# ╔═╡ 78e2da2d-126b-442f-91d0-4cf9c1a4e82c
prof_i

# ╔═╡ 693bcb86-29b8-4dd6-989b-641af3ff4b42
p = Ref{Plots.Plot}()

# ╔═╡ dfa6a5aa-e7ff-4e8b-b249-600ca7a02bc3
begin 
	p[] = plot()
	for prof in [prof_i, prof_f]
		scatter!(log10.(prof.rs), log10.(prof.ρs))
	end
	p[]
	xlabel!("log r / kpc")
	ylabel!("log density")
	plot!(asya_rho_dmi_x, asya_rho_dmi_y .- 10)
	plot!(asya_rho_dmf_x, asya_rho_dmf_y .- 10)

	# only include bound points in profile...
end

# ╔═╡ 6619ffaa-2e99-4be4-ad96-b22afda64b88
begin 
	p[] = plot()
	for prof in [prof_i, prof_f]
		scatter!(log10.(prof.rs), lguys.V0 * prof.Vs_circ)
	end
	p[]
	xlabel!("log r / kpc")
	ylabel!("circular velocity")

	# only include bound points in profile...
end

# ╔═╡ e6cbe208-2d1e-42c6-aadc-db3c2bd7c737
begin 
	x_cen = hcat([cen.x_c for cen in cens]...)
	v_cen = [cen.v_c for cen in cens]
end

# ╔═╡ 6497d973-d800-4052-a9b1-23f91dc3aa9f
begin 
	anim = @animate for i in 1:10:(length(out))
		snap = out[i]
		scatter(snap.positions[2, :], snap.positions[3, :], 
			ms=1, msw=0, ma=0.1, legend=false)
		xlims!(-200, 200)
		ylims!(-200, 200)
		scatter!([x_cen[2, i]], [x_cen[3, i]])
	end
	
	gif(anim, "sculptor.gif", fps = 15)
end

# ╔═╡ 5835c87b-ded1-4dd3-8ee8-333658f866ca
scatter(x_cen[2, :], x_cen[3, :])

# ╔═╡ 5899c047-b370-4a26-88bd-678bef4b0d5c
Ns = [sum(c.filt) for c in cens]

# ╔═╡ 10b92861-639e-4b35-b356-3baf9fc36b45
plot(Ns)

# ╔═╡ 8d43a142-7763-4749-95fa-c94b1a3b96ab
begin 
	lmc = lguys.Observation(ra=80.8942, dec=-69.7561, distance=50,
	pm_ra=NaN, pm_dec=NaN, radial_velocity=NaN)
	smc = lguys.Observation(ra=13.1584, dec=-72.8, distance=62,
	pm_ra=NaN, pm_dec=NaN, radial_velocity=NaN)
end

# ╔═╡ f3e6dc07-2ff5-4123-a4c4-d931d21ebf9f
1.3^(-1/2.5)

# ╔═╡ 1ae1b6ef-975b-4cac-a745-94a3a1272626
10 * (1)^(-2.5) * 1e3

# ╔═╡ fd81b538-be8b-4db1-a6b5-3b8b23563dc3
smc_gc = lguys.transform(lguys.Galactocentric, smc)

# ╔═╡ 3e745a53-0652-48d2-adb7-37a6a2e1c3cf
lguys.calc_r(lmc_gc.position)

# ╔═╡ 22436b56-6f76-4d9c-a39a-68881a5371ad
sqrt((50 - 60*cosd(21))^2 + (sind(21) * 60)^2)

# ╔═╡ 394c9d20-40db-4044-8555-62e9d41412e5
22 * (0.5 - 0.277 * log10(7e9 / 1.4e11))

# ╔═╡ Cell order:
# ╠═bb92b6c2-bf8d-11ee-13fb-770bf04d91e9
# ╠═6964cbd2-9ef9-4682-9ac1-80c10518c374
# ╟─76c5df92-1dde-4715-bd4f-2972e553e40f
# ╠═ad48a5bb-73e5-471f-ba06-4d1ad2016c5a
# ╠═dc6bef2c-e4eb-41ab-8f37-3569c068573a
# ╠═531cf5af-1e2d-4aaa-8c40-53358c47c398
# ╠═58957148-946c-4bbd-8d10-ebcbc899122f
# ╠═dfefa40c-f270-43bc-8421-8536a3da78f0
# ╠═78e2da2d-126b-442f-91d0-4cf9c1a4e82c
# ╠═693bcb86-29b8-4dd6-989b-641af3ff4b42
# ╠═dfa6a5aa-e7ff-4e8b-b249-600ca7a02bc3
# ╠═6619ffaa-2e99-4be4-ad96-b22afda64b88
# ╠═e6cbe208-2d1e-42c6-aadc-db3c2bd7c737
# ╠═6497d973-d800-4052-a9b1-23f91dc3aa9f
# ╠═5835c87b-ded1-4dd3-8ee8-333658f866ca
# ╠═5899c047-b370-4a26-88bd-678bef4b0d5c
# ╠═10b92861-639e-4b35-b356-3baf9fc36b45
# ╠═8d43a142-7763-4749-95fa-c94b1a3b96ab
# ╠═f3e6dc07-2ff5-4123-a4c4-d931d21ebf9f
# ╠═1ae1b6ef-975b-4cac-a745-94a3a1272626
# ╠═fd81b538-be8b-4db1-a6b5-3b8b23563dc3
# ╠═3e745a53-0652-48d2-adb7-37a6a2e1c3cf
# ╠═22436b56-6f76-4d9c-a39a-68881a5371ad
# ╠═394c9d20-40db-4044-8555-62e9d41412e5
